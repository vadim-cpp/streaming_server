<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Remote ASCII Stream</title>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" href="images/icon.png" type="image/x-icon">
    <style>
        .connection-panel {
            background-color: #2c2c2c;
            padding: 20px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
        }
        input[type="text"] {
            width: 100%;
            padding: 10px;
            border-radius: 4px;
            border: 1px solid #444;
            background-color: #333;
            color: white;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Remote ASCII Stream Viewer</h1>
        
        <div class="connection-panel">
            <div class="form-group">
                <label for="apiEndpoint">WebSocket Endpoint:</label>
                <input type="text" id="apiEndpoint" placeholder="ws://ip:port/stream">
            </div>
            <div class="form-group">
                <label for="apiKey">API Key:</label>
                <input type="text" id="apiKey" placeholder="Enter API key">
            </div>
            <button id="connectBtn">Connect to Stream</button>
        </div>
        
        <pre id="asciiOutput">Enter endpoint and API key, then click Connect</pre>
    </div>

    <script>
        class RemoteStreamViewer 
        {
            constructor() {
                this.output = document.getElementById('asciiOutput');
                this.ws = null;
                this.isConnected = false;
                
                document.getElementById('connectBtn').addEventListener('click', () => {
                    this.connect();
                });
            }
            
            connect() 
            {
                const endpoint = document.getElementById('apiEndpoint').value;
                const apiKey = document.getElementById('apiKey').value;
                
                if (!endpoint) 
                {
                    alert('Please enter WebSocket endpoint');
                    return;
                }
                
                if (this.ws) 
                {
                    this.ws.close();
                }
                
                this.output.textContent = 'Connecting...';
                
                this.ws = new WebSocket(endpoint);
                
                this.ws.onopen = () => {
                    this.output.textContent = 'Authenticating...';
                    
                    this.ws.send(JSON.stringify({
                        type: 'auth',
                        api_key: apiKey,
                        role: 'viewer'
                    }));
                };
                
                this.ws.onmessage = (event) => {
                    if (event.data === "AUTH_VIEWER_SUCCESS") {
                        this.output.textContent = 'Authenticated! Waiting for stream...';
                        this.isConnected = true;
                    } else if (event.data === "STREAM_ACTIVE") {
                        this.output.textContent = 'Stream is active. Receiving data...';
                    } else if (event.data === "STREAM_INACTIVE") {
                        this.output.textContent = 'Stream is inactive. Waiting...';
                    } else {
                        this.output.textContent = event.data;
                    }
                };
                
                this.ws.onerror = (error) => {
                    console.error('WebSocket error:', error);
                    this.output.textContent = 'Connection error!';
                    this.isConnected = false;
                };
                
                this.ws.onclose = () => {
                    this.output.textContent = 'Connection closed.';
                    this.isConnected = false;
                };
            }
        }
        
        window.addEventListener('load', () => new RemoteStreamViewer());
    </script>
</body>
</html>